{"ast":null,"code":"import React,{useEffect,useState,useRef}from\"react\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Cart=()=>{const[cart,setCart]=useState({});const[total,setTotal]=useState(0);const[timeLeft,setTimeLeft]=useState(null);const timerRef=useRef(null);useEffect(()=>{const loadCart=()=>{const stored=JSON.parse(localStorage.getItem(\"cart\"))||{};setCart(stored);};loadCart();window.addEventListener(\"focus\",loadCart);return()=>{window.removeEventListener(\"focus\",loadCart);};},[]);useEffect(()=>{const sum=Object.values(cart).reduce((acc,item)=>acc+item.price*item.quantity,0);setTotal(sum);if(Object.keys(cart).length>0){localStorage.setItem(\"cart\",JSON.stringify(cart));}},[cart]);const updateQuantity=(id,quantity)=>{const updated={...cart};if(quantity<=0){delete updated[id];}else{updated[id].quantity=quantity;updated[id].timestamp=Date.now();}setCart(updated);localStorage.setItem(\"cart\",JSON.stringify(updated));};const checkout=()=>{if(Object.keys(cart).length===0)return;const orders=JSON.parse(localStorage.getItem(\"orders\"))||[];orders.push({date:new Date().toLocaleString(),items:{...cart}});localStorage.setItem(\"orders\",JSON.stringify(orders));alert(\"–î—è–∫—É—î–º–æ! –í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ.\");setCart({});localStorage.removeItem(\"cart\");};useEffect(()=>{const syncCartAcrossTabs=e=>{if(e.key===\"cart\"){const updatedCart=JSON.parse(e.newValue)||{};setCart(updatedCart);}};window.addEventListener(\"storage\",syncCartAcrossTabs);return()=>{window.removeEventListener(\"storage\",syncCartAcrossTabs);};},[]);useEffect(()=>{if(Object.keys(cart).length===0){setTimeLeft(null);return;}setTimeLeft(15);if(timerRef.current)clearInterval(timerRef.current);timerRef.current=setInterval(()=>{setTimeLeft(prev=>{if(prev===1){clearInterval(timerRef.current);setCart({});localStorage.removeItem(\"cart\");return null;}return prev-1;});},1000);return()=>clearInterval(timerRef.current);},[cart]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDED2 \\u0412\\u0430\\u0448 \\u043A\\u043E\\u0448\\u0438\\u043A\"}),timeLeft!==null&&/*#__PURE__*/_jsxs(\"p\",{style:{color:\"red\"},children:[\"\\u23F3 \\u0417\\u0430\\u043B\\u0438\\u0448\\u0438\\u043B\\u043E\\u0441\\u044C \\u0447\\u0430\\u0441\\u0443 \\u0434\\u043B\\u044F \\u043E\\u0444\\u043E\\u0440\\u043C\\u043B\\u0435\\u043D\\u043D\\u044F: \",timeLeft,\" \\u0441\\u0435\\u043A.\"]}),Object.keys(cart).length===0?/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041A\\u043E\\u0448\\u0438\\u043A \\u043F\\u043E\\u0440\\u043E\\u0436\\u043D\\u0456\\u0439. \\u041F\\u0435\\u0440\\u0435\\u0439\\u0434\\u0456\\u0442\\u044C \\u0443 \",/*#__PURE__*/_jsx(\"a\",{href:\"/catalog\",children:\"\\u043A\\u0430\\u0442\\u0430\\u043B\\u043E\\u0433\"}),\", \\u0449\\u043E\\u0431 \\u0434\\u043E\\u0434\\u0430\\u0442\\u0438 \\u043A\\u043D\\u0438\\u0433\\u0438.\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"table\",{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"\\u041D\\u0430\\u0437\\u0432\\u0430\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u041A\\u0456\\u043B\\u044C\\u043A\\u0456\\u0441\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0426\\u0456\\u043D\\u0430\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0421\\u0443\\u043C\\u0430\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:Object.entries(cart).map(_ref=>{let[id,item]=_ref;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.title}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"1\",value:item.quantity,onChange:e=>updateQuantity(id,parseInt(e.target.value))})}),/*#__PURE__*/_jsxs(\"td\",{children:[item.price,\" \\u0433\\u0440\\u043D\"]}),/*#__PURE__*/_jsxs(\"td\",{children:[item.price*item.quantity,\" \\u0433\\u0440\\u043D\"]})]},id);})})]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"\\u0420\\u0430\\u0437\\u043E\\u043C: \",total,\" \\u0433\\u0440\\u043D\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:checkout,children:\"\\u2705 \\u041E\\u0444\\u043E\\u0440\\u043C\\u0438\\u0442\\u0438 \\u0437\\u0430\\u043C\\u043E\\u0432\\u043B\\u0435\\u043D\\u043D\\u044F\"})]})]});};export default Cart;","map":{"version":3,"names":["React","useEffect","useState","useRef","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Cart","cart","setCart","total","setTotal","timeLeft","setTimeLeft","timerRef","loadCart","stored","JSON","parse","localStorage","getItem","window","addEventListener","removeEventListener","sum","Object","values","reduce","acc","item","price","quantity","keys","length","setItem","stringify","updateQuantity","id","updated","timestamp","Date","now","checkout","orders","push","date","toLocaleString","items","alert","removeItem","syncCartAcrossTabs","e","key","updatedCart","newValue","current","clearInterval","setInterval","prev","children","style","color","href","entries","map","_ref","title","type","min","value","onChange","parseInt","target","onClick"],"sources":["/Users/andrijzuk/AndriZhok.github.io/lab3R/bookstore/src/components/Cart.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\n\nconst Cart = () => {\n  const [cart, setCart] = useState({});\n  const [total, setTotal] = useState(0);\n  const [timeLeft, setTimeLeft] = useState(null);\n  const timerRef = useRef(null);\n\n  useEffect(() => {\n    const loadCart = () => {\n      const stored = JSON.parse(localStorage.getItem(\"cart\")) || {};\n      setCart(stored);\n    };\n\n    loadCart();\n    window.addEventListener(\"focus\", loadCart);\n\n    return () => {\n      window.removeEventListener(\"focus\", loadCart);\n    };\n  }, []);\n\n  useEffect(() => {\n    const sum = Object.values(cart).reduce(\n      (acc, item) => acc + item.price * item.quantity,\n      0\n    );\n    setTotal(sum);\n    if (Object.keys(cart).length > 0) {\n      localStorage.setItem(\"cart\", JSON.stringify(cart));\n    }\n  }, [cart]);\n\n  const updateQuantity = (id, quantity) => {\n    const updated = { ...cart };\n    if (quantity <= 0) {\n      delete updated[id];\n    } else {\n      updated[id].quantity = quantity;\n      updated[id].timestamp = Date.now();\n    }\n    setCart(updated);\n    localStorage.setItem(\"cart\", JSON.stringify(updated));\n  };\n\n  const checkout = () => {\n    if (Object.keys(cart).length === 0) return;\n    const orders = JSON.parse(localStorage.getItem(\"orders\")) || [];\n    orders.push({ date: new Date().toLocaleString(), items: { ...cart } });\n    localStorage.setItem(\"orders\", JSON.stringify(orders));\n    alert(\"–î—è–∫—É—î–º–æ! –í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ.\");\n    setCart({});\n    localStorage.removeItem(\"cart\");\n  };\n\n  useEffect(() => {\n    const syncCartAcrossTabs = (e) => {\n      if (e.key === \"cart\") {\n        const updatedCart = JSON.parse(e.newValue) || {};\n        setCart(updatedCart);\n      }\n    };\n    window.addEventListener(\"storage\", syncCartAcrossTabs);\n    return () => {\n      window.removeEventListener(\"storage\", syncCartAcrossTabs);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (Object.keys(cart).length === 0) {\n      setTimeLeft(null);\n      return;\n    }\n\n    setTimeLeft(15);\n    if (timerRef.current) clearInterval(timerRef.current);\n\n    timerRef.current = setInterval(() => {\n      setTimeLeft(prev => {\n        if (prev === 1) {\n          clearInterval(timerRef.current);\n          setCart({});\n          localStorage.removeItem(\"cart\");\n          return null;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n\n    return () => clearInterval(timerRef.current);\n  }, [cart]);\n\n  return (\n    <div>\n      <h1>üõí –í–∞—à –∫–æ—à–∏–∫</h1>\n      {timeLeft !== null && (\n        <p style={{ color: \"red\" }}>\n          ‚è≥ –ó–∞–ª–∏—à–∏–ª–æ—Å—å —á–∞—Å—É –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è: {timeLeft} —Å–µ–∫.\n        </p>\n      )}\n      {Object.keys(cart).length === 0 ? (\n        <p>–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π. –ü–µ—Ä–µ–π–¥—ñ—Ç—å —É <a href=\"/catalog\">–∫–∞—Ç–∞–ª–æ–≥</a>, —â–æ–± –¥–æ–¥–∞—Ç–∏ –∫–Ω–∏–≥–∏.</p>\n      ) : (\n        <>\n          <table>\n            <thead>\n              <tr>\n                <th>–ù–∞–∑–≤–∞</th>\n                <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>\n                <th>–¶—ñ–Ω–∞</th>\n                <th>–°—É–º–∞</th>\n              </tr>\n            </thead>\n            <tbody>\n            {Object.entries(cart).map(([id, item]) => (\n            <tr key={id}>\n            <td>{item.title}</td>\n                  <td>\n                    <input\n                      type=\"number\"\n                      min=\"1\"\n                      value={item.quantity}\n                      onChange={(e) => updateQuantity(id, parseInt(e.target.value))}\n                    />\n                  </td>\n                  <td>{item.price} –≥—Ä–Ω</td>\n                  <td>{item.price * item.quantity} –≥—Ä–Ω</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n          <h3>–†–∞–∑–æ–º: {total} –≥—Ä–Ω</h3>\n          <button onClick={checkout}>‚úÖ –û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default Cart;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,CAAEC,MAAM,KAAQ,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAE3D,KAAM,CAAAC,IAAI,CAAGA,CAAA,GAAM,CACjB,KAAM,CAACC,IAAI,CAAEC,OAAO,CAAC,CAAGV,QAAQ,CAAC,CAAC,CAAC,CAAC,CACpC,KAAM,CAACW,KAAK,CAAEC,QAAQ,CAAC,CAAGZ,QAAQ,CAAC,CAAC,CAAC,CACrC,KAAM,CAACa,QAAQ,CAAEC,WAAW,CAAC,CAAGd,QAAQ,CAAC,IAAI,CAAC,CAC9C,KAAM,CAAAe,QAAQ,CAAGd,MAAM,CAAC,IAAI,CAAC,CAE7BF,SAAS,CAAC,IAAM,CACd,KAAM,CAAAiB,QAAQ,CAAGA,CAAA,GAAM,CACrB,KAAM,CAAAC,MAAM,CAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,EAAI,CAAC,CAAC,CAC7DX,OAAO,CAACO,MAAM,CAAC,CACjB,CAAC,CAEDD,QAAQ,CAAC,CAAC,CACVM,MAAM,CAACC,gBAAgB,CAAC,OAAO,CAAEP,QAAQ,CAAC,CAE1C,MAAO,IAAM,CACXM,MAAM,CAACE,mBAAmB,CAAC,OAAO,CAAER,QAAQ,CAAC,CAC/C,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAENjB,SAAS,CAAC,IAAM,CACd,KAAM,CAAA0B,GAAG,CAAGC,MAAM,CAACC,MAAM,CAAClB,IAAI,CAAC,CAACmB,MAAM,CACpC,CAACC,GAAG,CAAEC,IAAI,GAAKD,GAAG,CAAGC,IAAI,CAACC,KAAK,CAAGD,IAAI,CAACE,QAAQ,CAC/C,CACF,CAAC,CACDpB,QAAQ,CAACa,GAAG,CAAC,CACb,GAAIC,MAAM,CAACO,IAAI,CAACxB,IAAI,CAAC,CAACyB,MAAM,CAAG,CAAC,CAAE,CAChCd,YAAY,CAACe,OAAO,CAAC,MAAM,CAAEjB,IAAI,CAACkB,SAAS,CAAC3B,IAAI,CAAC,CAAC,CACpD,CACF,CAAC,CAAE,CAACA,IAAI,CAAC,CAAC,CAEV,KAAM,CAAA4B,cAAc,CAAGA,CAACC,EAAE,CAAEN,QAAQ,GAAK,CACvC,KAAM,CAAAO,OAAO,CAAG,CAAE,GAAG9B,IAAK,CAAC,CAC3B,GAAIuB,QAAQ,EAAI,CAAC,CAAE,CACjB,MAAO,CAAAO,OAAO,CAACD,EAAE,CAAC,CACpB,CAAC,IAAM,CACLC,OAAO,CAACD,EAAE,CAAC,CAACN,QAAQ,CAAGA,QAAQ,CAC/BO,OAAO,CAACD,EAAE,CAAC,CAACE,SAAS,CAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,CACpC,CACAhC,OAAO,CAAC6B,OAAO,CAAC,CAChBnB,YAAY,CAACe,OAAO,CAAC,MAAM,CAAEjB,IAAI,CAACkB,SAAS,CAACG,OAAO,CAAC,CAAC,CACvD,CAAC,CAED,KAAM,CAAAI,QAAQ,CAAGA,CAAA,GAAM,CACrB,GAAIjB,MAAM,CAACO,IAAI,CAACxB,IAAI,CAAC,CAACyB,MAAM,GAAK,CAAC,CAAE,OACpC,KAAM,CAAAU,MAAM,CAAG1B,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,CAAC,EAAI,EAAE,CAC/DuB,MAAM,CAACC,IAAI,CAAC,CAAEC,IAAI,CAAE,GAAI,CAAAL,IAAI,CAAC,CAAC,CAACM,cAAc,CAAC,CAAC,CAAEC,KAAK,CAAE,CAAE,GAAGvC,IAAK,CAAE,CAAC,CAAC,CACtEW,YAAY,CAACe,OAAO,CAAC,QAAQ,CAAEjB,IAAI,CAACkB,SAAS,CAACQ,MAAM,CAAC,CAAC,CACtDK,KAAK,CAAC,qCAAqC,CAAC,CAC5CvC,OAAO,CAAC,CAAC,CAAC,CAAC,CACXU,YAAY,CAAC8B,UAAU,CAAC,MAAM,CAAC,CACjC,CAAC,CAEDnD,SAAS,CAAC,IAAM,CACd,KAAM,CAAAoD,kBAAkB,CAAIC,CAAC,EAAK,CAChC,GAAIA,CAAC,CAACC,GAAG,GAAK,MAAM,CAAE,CACpB,KAAM,CAAAC,WAAW,CAAGpC,IAAI,CAACC,KAAK,CAACiC,CAAC,CAACG,QAAQ,CAAC,EAAI,CAAC,CAAC,CAChD7C,OAAO,CAAC4C,WAAW,CAAC,CACtB,CACF,CAAC,CACDhC,MAAM,CAACC,gBAAgB,CAAC,SAAS,CAAE4B,kBAAkB,CAAC,CACtD,MAAO,IAAM,CACX7B,MAAM,CAACE,mBAAmB,CAAC,SAAS,CAAE2B,kBAAkB,CAAC,CAC3D,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAENpD,SAAS,CAAC,IAAM,CACd,GAAI2B,MAAM,CAACO,IAAI,CAACxB,IAAI,CAAC,CAACyB,MAAM,GAAK,CAAC,CAAE,CAClCpB,WAAW,CAAC,IAAI,CAAC,CACjB,OACF,CAEAA,WAAW,CAAC,EAAE,CAAC,CACf,GAAIC,QAAQ,CAACyC,OAAO,CAAEC,aAAa,CAAC1C,QAAQ,CAACyC,OAAO,CAAC,CAErDzC,QAAQ,CAACyC,OAAO,CAAGE,WAAW,CAAC,IAAM,CACnC5C,WAAW,CAAC6C,IAAI,EAAI,CAClB,GAAIA,IAAI,GAAK,CAAC,CAAE,CACdF,aAAa,CAAC1C,QAAQ,CAACyC,OAAO,CAAC,CAC/B9C,OAAO,CAAC,CAAC,CAAC,CAAC,CACXU,YAAY,CAAC8B,UAAU,CAAC,MAAM,CAAC,CAC/B,MAAO,KAAI,CACb,CACA,MAAO,CAAAS,IAAI,CAAG,CAAC,CACjB,CAAC,CAAC,CACJ,CAAC,CAAE,IAAI,CAAC,CAER,MAAO,IAAMF,aAAa,CAAC1C,QAAQ,CAACyC,OAAO,CAAC,CAC9C,CAAC,CAAE,CAAC/C,IAAI,CAAC,CAAC,CAEV,mBACEJ,KAAA,QAAAuD,QAAA,eACEzD,IAAA,OAAAyD,QAAA,CAAI,gEAAY,CAAI,CAAC,CACpB/C,QAAQ,GAAK,IAAI,eAChBR,KAAA,MAAGwD,KAAK,CAAE,CAAEC,KAAK,CAAE,KAAM,CAAE,CAAAF,QAAA,EAAC,gLACQ,CAAC/C,QAAQ,CAAC,sBAC9C,EAAG,CACJ,CACAa,MAAM,CAACO,IAAI,CAACxB,IAAI,CAAC,CAACyB,MAAM,GAAK,CAAC,cAC7B7B,KAAA,MAAAuD,QAAA,EAAG,iJAA4B,cAAAzD,IAAA,MAAG4D,IAAI,CAAC,UAAU,CAAAH,QAAA,CAAC,4CAAO,CAAG,CAAC,4FAAmB,EAAG,CAAC,cAEpFvD,KAAA,CAAAE,SAAA,EAAAqD,QAAA,eACEvD,KAAA,UAAAuD,QAAA,eACEzD,IAAA,UAAAyD,QAAA,cACEvD,KAAA,OAAAuD,QAAA,eACEzD,IAAA,OAAAyD,QAAA,CAAI,gCAAK,CAAI,CAAC,cACdzD,IAAA,OAAAyD,QAAA,CAAI,wDAAS,CAAI,CAAC,cAClBzD,IAAA,OAAAyD,QAAA,CAAI,0BAAI,CAAI,CAAC,cACbzD,IAAA,OAAAyD,QAAA,CAAI,0BAAI,CAAI,CAAC,EACX,CAAC,CACA,CAAC,cACRzD,IAAA,UAAAyD,QAAA,CACClC,MAAM,CAACsC,OAAO,CAACvD,IAAI,CAAC,CAACwD,GAAG,CAACC,IAAA,MAAC,CAAC5B,EAAE,CAAER,IAAI,CAAC,CAAAoC,IAAA,oBACrC7D,KAAA,OAAAuD,QAAA,eACAzD,IAAA,OAAAyD,QAAA,CAAK9B,IAAI,CAACqC,KAAK,CAAK,CAAC,cACfhE,IAAA,OAAAyD,QAAA,cACEzD,IAAA,UACEiE,IAAI,CAAC,QAAQ,CACbC,GAAG,CAAC,GAAG,CACPC,KAAK,CAAExC,IAAI,CAACE,QAAS,CACrBuC,QAAQ,CAAGnB,CAAC,EAAKf,cAAc,CAACC,EAAE,CAAEkC,QAAQ,CAACpB,CAAC,CAACqB,MAAM,CAACH,KAAK,CAAC,CAAE,CAC/D,CAAC,CACA,CAAC,cACLjE,KAAA,OAAAuD,QAAA,EAAK9B,IAAI,CAACC,KAAK,CAAC,qBAAI,EAAI,CAAC,cACzB1B,KAAA,OAAAuD,QAAA,EAAK9B,IAAI,CAACC,KAAK,CAAGD,IAAI,CAACE,QAAQ,CAAC,qBAAI,EAAI,CAAC,GAXtCM,EAYD,CAAC,EACN,CAAC,CACG,CAAC,EACH,CAAC,cACRjC,KAAA,OAAAuD,QAAA,EAAI,kCAAO,CAACjD,KAAK,CAAC,qBAAI,EAAI,CAAC,cAC3BR,IAAA,WAAQuE,OAAO,CAAE/B,QAAS,CAAAiB,QAAA,CAAC,sHAAqB,CAAQ,CAAC,EACzD,CACH,EACE,CAAC,CAEV,CAAC,CAED,cAAe,CAAApD,IAAI","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}